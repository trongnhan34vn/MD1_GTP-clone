<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ hàng</title>
    <link rel="shortcut icon" type="image/x-icon"
          href="https://theme.hstatic.net/200000388065/1000766714/14/logo.png?v=111"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="fonts/fontawesome-free-6.2.0-web/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <script src="script/User.js"></script>
</head>

<body>
<div class="app">
    <!-- Header -->
    <div class="header">
        <div class="header-navbar__contact">
            <div class="header-navbar__contact-item">
                <i class="fa-sharp fa-solid fa-house-chimney"></i>
                <a href="">Hệ thống cửa hàng</a>
            </div>
            <div class="header-navbar__contact-item">
                <i class="fa-solid fa-phone"></i>
                <a href="">Mua hàng online: 0969436769</a>
            </div>
        </div>
        <div class="header-navbar-feat">
            <div class="grid">
                <div class="header-navbar-container header-navbar-container--cart">
                    <div class="header-navbar-cart-item">
                        <div class="header-navbar-item">
                            <div class="header-navbar__logo">
                                <a href="index.html">
                                    <img src="https://theme.hstatic.net/200000388065/1000766714/14/logo.png?v=111"
                                         alt="">
                                </a>
                            </div>
                        </div>
                        <div class="header-navbar-item">
                            <h1 class="header-navbar-cart-item">Giỏ hàng</h1>
                        </div>
                    </div>
                    <div class="header-navbar-item header-navbar-item__float-right">
                        <input oninput="actionSearch()" id="searchProduct" placeholder="Tìm kiếm" class="header-navbar-cart__search" type="text">
                        <button class="header-navbar-cart-item"><i class="bi bi-search"></i></button>
                    </div>
                    <div class="header-navbar-item header-navbar-cart__user">
                        <ul class="header-navbar__features">
                            <li class="nav-account"><span><i class="bi bi-person-circle"></i><span id="account">Tài khoản</span></span>
                                <!-- Regis & Login -->
                                <div class="nav-account-container">
                                    <a class="sign-up account-info" href="register.html">Đăng kí</a>
                                    <a class="sign-in account-cart" href="login.html">Đăng nhập</a>
                                    <a onclick="logOut()" class="logOut" href=""></a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="register product-lists">
        <div class="grid">
            <table class="products-table" style="width: 100%">
                <tr>
                    <th width="50%" colspan="2">Products</th>
                    <th>Unit Price</th>
                    <th>Quantity</th>
                    <th>Total Price</th>
                    <th>Actions</th>
                </tr>
                <tbody id="draw-table">
                <!--                <tr>-->
                <!--                    <td>-->
                <!--                        <img style="width: 80px"-->
                <!--                             src="https://product.hstatic.net/200000388065/product/859cf541-b3c3-40bc-a43c-2ab90feb1e55_6f98e69436884d77a3cf97a4b0f9683f_large.jpg"-->
                <!--                             alt="">-->
                <!--                        <p style="padding: 10px">Amp Marshal MG10G 10W</p>-->
                <!--                    </td>-->
                <!--                    <td>2.000.000đ</td>-->
                <!--                    <td>1</td>-->
                <!--                    <td></td>-->
                <!--                    <td>-->
                <!--                        <button>delete</button>-->
                <!--                    </td>-->
                <!--                </tr>-->
                </tbody>
            </table>
        </div>
    </div>
    <div class="footer">
        <div class="grid">
            <div class="footer-container">
                <div class="footer-logo">
                    <img src="https://theme.hstatic.net/200000388065/1000766714/14/logo.png?v=111" alt="">
                </div>
                <ul class="footer-social">
                    <li><a href=""><i class="bi bi-youtube"></i></a></li>
                    <li><a href=""><i class="bi bi-instagram"></i></a></li>
                    <li><a href=""><i class="bi bi-facebook"></i></a></li>
                    <li><a href=""><i class="bi bi-twitter"></i></a></li>
                </ul>
                <div class="footer-copyright">
                    <h3>© 2021 GUITARPLUS • ALL RIGHTS RESERVED</h3>
                </div>
                <ul class="footer-link">
                    <li><a href="">Trang chủ</a></li>
                    <li><a href="">Sản phẩm</a></li>
                    <li><a href="">Thương hiệu</a></li>
                    <li><a href="">Blog</a></li>
                    <li><a href="">Giới thiệu</a></li>
                    <li><a href="">Liên hệ</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<script>
    let currentUser = localStorage.getItem("current_user");
    if (currentUser !== null) {
        document.getElementById('account').innerHTML = currentUser;
        document.querySelector('.account-info').innerHTML = "Thông tin tài khoản";
        document.querySelector('.account-cart').innerHTML = "Giỏ hàng";
        document.querySelector('.logOut').innerHTML = "Đăng xuất";
        document.querySelector('.logOut').style.color = "red";
    } else {
        document.querySelector('.logOut').style.display = "none";
    }

    function logOut() {
        localStorage.removeItem("current_user");
        location.reload();
    }

    let listProducts = JSON.parse(localStorage.getItem('list_product'));
    let detectID = JSON.parse(localStorage.getItem('detectID'));
    console.log(detectID)

    // vẽ vào bảng
    let checkProductExisted = false;
    let drawTable;
    let hold = [];

    function showCart() {
        for (let i = 0; i < listProducts.length; i++) {
            for (let j = 0; j < detectID.length; j++) {
                if (detectID[j] == listProducts[i].id) {
                    checkProductExisted = true;
                    hold.push(listProducts[i]);
                    console.log(hold)
                    break;
                }
            }
        }

        if (checkProductExisted) {
            drawTable = "";
            for (let i = 0; i < hold.length; i++) {
                drawTable += `<tr id="deleteTable">
                    <td>
                        <img style="width: 80px"
                             src=${hold[i].img}
                             alt="">
                    </td>
                    <td>
                        <p style="font-weight: bold; text-align: left; padding-right: 8px">${hold[i].name}</p>
                    </td>
                    <td id="price">${hold[i].price}</td>
                    <td><input oninput="" style="text-align: center" id="countProducts" value="1" type="number"></td>
                    <td><span id="totalPrice"></span></td>
                    <td>
                        <button onclick="deleteProduct(${i})">delete</button>
                    </td>
                </tr>`
            }
            document.getElementById('draw-table').innerHTML = drawTable;
        }
    }

    showCart();

    // Xoá

    function deleteProduct(index) {
        console.log(index)
        hold.splice(index,1);
        detectID.splice(index,1);
        localStorage.removeItem('detectID');
        localStorage.setItem('detectID',JSON.stringify(detectID));
        if(detectID.length == 0) {
            location.href = "index.html";
        }else {
            if(countProducts == 1) {
                document.getElementById('deleteTable').style.display = "none";
            }
        }
        console.log(hold);
    }


    //  kiểm tra số ptu trùng trong mảng
    let flag = false;
    let checkArr = [];
    for (let i = 0; i < detectID.length; i++) {
        for (let j = i+1; j < detectID.length; j++) {
            if(detectID[i] === detectID[j]) {
                flag = true;
                checkArr.push(detectID[i]);
                break;
            }
        }
    }
    let countProducts = 0;
    for (let i = 0; i < detectID.length; i++) {
        for (let j = 0; j < checkArr.length; j++) {
            if(detectID[i] == checkArr[j]) {
                countProducts ++;

            }
        }
    }

    console.log(checkArr)
    console.log(countProducts)

    for (let i = 0; i < hold.length; i++) {
        for (let j = 0; j < checkArr.length; j++) {
            if(hold[i].id == checkArr[j]) {

            }
        }
    }
    // Tìm kiếm
    let listSearch = [];
    function actionSearch() {
        let productSearch = document.getElementById('searchProduct').value;
        if(productSearch.trim() == "") {
            showCart();
            console.log('ngủ đê')
        } else {
            listSearch = [];
            for (let i = 0; i < hold.length; i++) {
                if(hold[i].name.toLowerCase().search(productSearch.toLowerCase()) !== -1) {
                    listSearch.push(hold[i]);
                }
                console.log(hold[i].name);
            }
            console.log(listSearch)
            console.log(productSearch)
            showListSearch();
        }
    }

    function showListSearch() {
        drawTable = "";
        for (let i = 0; i < listSearch.length; i++) {
            drawTable += `<tr id="deleteTable">
                    <td>
                        <img style="width: 80px"
                             src=${listSearch[i].img}
                             alt="">
                    </td>
                    <td>
                        <p style="font-weight: bold; text-align: left; padding-right: 8px">${listSearch[i].name}</p>
                    </td>
                    <td id="price">${listSearch[i].price}</td>
                    <td><input oninput="" style="text-align: center" id="countProducts" value="1" type="number"></td>
                    <td><span id="totalPrice"></span></td>
                    <td>
                        <button onclick="deleteProduct()">delete</button>
                    </td>
                </tr>`
        }
        document.getElementById('draw-table').innerHTML = drawTable;
    }

</script>
</body>

</html>